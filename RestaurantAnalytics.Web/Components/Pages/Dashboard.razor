@page "/dashboard"
@using RestaurantAnalytics.Core.Interfaces
@inject ISalesRepository SalesRepo

<h3>Faturamento Diário - Últimos 7 dias</h3>

@if (dailyRevenue is null)
{
    <p>Carregando...</p>
}
else
{
    <MudChart ChartType="ChartType.Line" Labels="labels" Data="data" />
}

@code {
    Dictionary<DateTime, decimal>? dailyRevenue;
    string[] labels = Array.Empty<string>();
    double[] data = Array.Empty<double>();

    protected override async Task OnInitializedAsync()
    {
        var end = DateTime.UtcNow;
        var start = end.AddDays(-7);

        dailyRevenue = await SalesRepo.GetDailyRevenueAsync(start, end);

        labels = dailyRevenue.Keys.Select(d => d.ToString("dd/MM")).ToArray();
        data = dailyRevenue.Values.Select(v => (double)v).ToArray();
    }
}
